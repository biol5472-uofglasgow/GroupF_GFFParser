version: '3.8'

services:
  gene-summariser:
    build:
      context: .
      dockerfile: Dockerfile
    image: gene-summariser:latest
    container_name: gene-summariser-app
    volumes:
      # Mount test data from fixtures (or change to ./data for your own files)
      - ./tests/fixtures:/data
      - ./results:/app/results
    environment:
      - PYTHONUNBUFFERED=1
    # Override default command
    # Example: Run on test data
    command: >
      --gff /data/models.gff3
      --fasta /data/testfasta.fasta
      --outdir /app/results
    # For your own data, change volumes to:
    # - ./data:/data
    # And update the command accordingly
    
    # For interactive use, comment out command and use:
    # stdin_open: true
    # tty: true
    # entrypoint: /bin/bash

  # Optional: Development container with tests
  gene-summariser-dev:
    build:
      context: .
      dockerfile: Dockerfile
      target: development
    image: gene-summariser:dev
    container_name: gene-summariser-dev
    volumes:
      - .:/app
      - /app/.pytest_cache
      - /app/htmlcov
    environment:
      - PYTHONUNBUFFERED=1
    command: pytest --cov=gene_summariser --cov-report=html